CRBEHAVE_CFLAGS = @CRBEHAVE_CFLAGS@
CRBEHAVE_LDFLAGS = @CRBEHAVE_LDFLAGS@
CFLAGS = $(CRBEHAVE_CFLAGS) -Wall -g -std=c99
LDFLAGS = $(CRBEHAVE_LDFLAGS)

SRCS=tuple.c ppm.c
OBJS=$(SRCS:.c=.o)

TEST_SRCS=tests/tuples.c tests/canvas.c tests/matrix.c tests/bank.c
TEST_OBJS=$(TEST_SRCS:.c=.o)
TEST_PROGS=$(TEST_SRCS:.c=)

all: $(OBJS) $(TEST_OBJS) $(TEST_PROGS)

.c.o:
	$(CC) $(CFLAGS) -c $<

$(TEST_PROGS): $(TEST_OBJS)
	$(CC) $@.o $(OBJS) -o$@ $(LDFLAGS)

$(TEST_OBJS):
	$(CC) $(CFLAGS) -c $(@:.o=.c) -o$@

check: $(TEST_PROGS)
	cd tests && ./tuples
	cd tests && ./canvas
	cd tests && ./matrix
	cd tests && ./bank

clean:
	rm -f $(PROG) $(OBJS) $(TEST_OBJS)
